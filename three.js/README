# Durham Castle Builder - 游戏设计文档 (GDD)

## 1. 游戏概述

### 1.1 愿景陈述
通过沉浸式3D建造体验，让玩家了解杜伦城堡的历史与建筑特色，同时享受建造过程中的成就感和挑战。

### 1.2 游戏概念
**Durham Castle Builder** 是一款基于Web的3D建造模拟游戏，使用three.js引擎开发。玩家将扮演中世纪杜伦城堡的首席建筑师，指挥工匠团队运用历史建筑技术，从地基开始逐步重建这座历史悠久的城堡。游戏融合了策略、模拟经营和教育元素，让玩家在享受建造乐趣的同时，深入了解中世纪建筑工艺和杜伦城堡的历史文化。

### 1.3 核心玩法
- 指挥AI工匠团队完成建造任务
- 管理资源（石材、木材、人力等）
- 解锁历史时期的建筑元素和技术
- 应对各种挑战和随机事件

### 1.4 目标受众
- 历史爱好者和教育工作者
- 建造模拟游戏粉丝
- 对中世纪建筑感兴趣的玩家
- 寻求轻松休闲体验的玩家（12岁以上）

### 1.5 平台与技术
- 基于Web的单页应用
- 使用three.js进行3D渲染
- 原生JavaScript (ES6+) 和 HTML5
- Web Workers处理AI计算
- 支持现代浏览器（Chrome, Firefox, Edge等）

## 2. 游戏机制

### 2.1 建造系统

#### 2.1.1 建造流程
1. 规划阶段：选择要建造的建筑元素
2. 准备阶段：分配资源和工匠
3. 施工阶段：工匠自动执行建造任务
4. 完成阶段：验收工程并解锁新内容

#### 2.1.2 建筑元素分类
- 结构性元素：墙体、塔楼、拱门、地基
- 装饰性元素：雕刻、彩窗、旗帜
- 功能性建筑：作坊、仓库、住所

### 2.2 资源管理系统

#### 2.2.1 资源类型
- **石材**：主要建筑材料，从采石场获取
- **木材**：辅助建材和工具原料，从森林获取
- **食物**：维持工匠体力和工作效率
- **金钱**：用于购买特殊材料和工具

#### 2.2.2 资源获取与消耗
- 资源随时间自然产生
- 不同建筑元素消耗不同类型和数量的资源
- 资源短缺会影响建造进度和工匠效率

### 2.3 反馈循环机制

#### 2.3.1 即时反馈
- 工匠动作实时可视化
- 建造进度条显示
- 资源数值即时更新

#### 2.3.2 长期反馈
- 完成里程碑解锁新建筑元素
- 技能树系统提升工匠能力
- 成就系统记录玩家进展

### 2.4 能力成长系统

#### 2.4.1 工匠技能树
- **初级工匠**：只能执行基础任务（搬运、简单加工）
- **中级工匠**：掌握砌石、木工等专业技能
- **专家工匠**：精通雕刻、结构加固等高级技艺

#### 2.4.2 工具升级路径
- 手工工具 → 简单机械 → 复杂装置
- 更高效率但需要更多资源维护

## 3. AI行为设计

### 3.1 工匠AI系统

#### 3.1.1 寻路算法
使用A*算法实现智能寻路，能够：
- 自动寻找最短路径到达工作区域
- 避开障碍物和其他工匠
- 动态调整路线应对临时阻碍

#### 3.1.2 任务分配机制
- 根据工匠技能和当前需求智能分配任务
- 支持多工匠协同作业（例如一人运送材料，另一人施工）
- 自动平衡工作负载避免某些工匠过载

#### 3.1.3 行为状态机
工匠具有以下状态：
- 空闲：等待任务分配
- 移动：前往指定位置
- 工作：执行具体建造任务
- 休息：恢复体力值

### 3.2 工具使用AI

#### 3.2.1 工具选择逻辑
- 根据任务类型自动选择合适工具
- 考虑工具效率和资源消耗做决策
- 支持工具组合使用（复杂工序）

#### 3.2.2 工具使用动画
- 真实模拟工具使用过程
- 显示工具磨损和维护需求
- 特殊工具具有独特视觉效果

## 4. 用户界面设计

### 4.1 界面布局
- **主视图**：3D城堡建造场景
- **资源面板**：显示各类资源数量
- **任务面板**：显示当前任务和进度
- **工匠面板**：显示工匠状态和技能
- **建造菜单**：选择要建造的建筑元素

### 4.2 交互设计
- 鼠标点击选择建筑区域
- 拖拽调整视角
- 右键菜单快速访问功能
- 快捷键提高操作效率

### 4.3 可访问性设计
- 支持键盘导航
- 可调节的游戏速度
- 语音提示系统
- 高对比度UI选项
- 字体大小调整功能

## 5. 软件架构

### 5.1 分层架构设计

#### 5.1.1 游戏逻辑层 (core/)
负责处理游戏核心规则和状态：
- [Game.js](file:///d:/vscode/three.js/js/core/Game.js) - 游戏主控制器
- [GameState.js](file:///d:/vscode/three.js/js/core/GameState.js) - 游戏状态管理
- [Resource.js](file:///d:/vscode/three.js/js/core/Resource.js) - 资源系统
- [AI.js](file:///d:/vscode/three.js/js/core/AI.js) - AI行为管理

#### 5.1.2 UI层 (ui/)
负责用户界面和交互：
- [UI.js](file:///d:/vscode/three.js/js/ui/UI.js) - UI主类
- [HUD.js](file:///d:/vscode/three.js/js/ui/HUD.js) - 抬头显示器
- [Menu.js](file:///d:/vscode/three.js/js/ui/Menu.js) - 菜单系统

#### 5.1.3 渲染层 (graphics/)
负责3D渲染和视觉效果：
- [Renderer.js](file:///d:/vscode/three.js/js/graphics/Renderer.js) - three.js渲染器
- [Camera.js](file:///d:/vscode/three.js/js/graphics/Camera.js) - 相机控制系统
- [Lighting.js](file:///d:/vscode/three.js/js/graphics/Lighting.js) - 光照系统

#### 5.1.4 工具层 (utils/)
通用工具函数库：
- [MathUtils.js](file:///d:/vscode/three.js/js/utils/MathUtils.js) - 数学计算工具
- [Pathfinding.js](file:///d:/vscode/three.js/js/utils/Pathfinding.js) - 路径查找算法

#### 5.1.5 并行计算 (workers/)
Web Workers处理密集计算：
- [worker.js](file:///d:/vscode/three.js/workers/worker.js) - AI计算专用Worker

### 5.2 设计模式应用

#### 5.2.1 状态模式
用于管理游戏的不同阶段（菜单、建造中、暂停、完成等）

#### 5.2.2 观察者模式
实现事件系统，模块间松耦合通信

#### 5.2.3 对象池模式
复用工匠和工具对象，减少内存分配和垃圾回收压力

#### 5.2.4 模块化设计
各功能模块独立封装，便于维护和扩展

## 6. 内容设计

### 6.1 历史时期划分
游戏按时间顺序分为以下几个历史时期：
1. **诺曼时期 (1071-1133)** - 城堡初建阶段
2. **主教时期 (1133-1540)** - 主要扩建和完善阶段
3. **王室时期 (1540-1660)** - 王室入驻后的改造
4. **现代修复 (1660至今)** - 近代修复和保护工作

### 6.2 建筑元素设计
每个时期包含独特的建筑元素：
- 地基和墙体结构
- 塔楼和防御设施
- 内部装饰和家具
- 园艺和周边环境

### 6.3 教育内容集成
- 每个建筑元素附带历史背景介绍
- 关键节点解锁历史故事和人物传记
- 展示中世纪建筑技术和工艺流程
- 提供杜伦地区历史文化相关信息

## 7. 技术规格

### 7.1 性能要求
- 目标帧率：稳定60 FPS（高端设备）
- 最低帧率：30 FPS（主流设备）
- 同时活跃AI工匠数：至少50个
- 模型加载时间：单个模型小于1秒

### 7.2 兼容性要求
- Chrome 70+
- Firefox 65+
- Edge 79+
- Safari 12+ (有限支持)

### 7.3 优化策略
- 使用对象池减少GC压力
- LOD(Level of Detail)系统优化远处模型
- 纹理压缩和合并减少内存占用
- AI计算迁移至Web Worker

## 8. 游戏流程

### 8.1 初始阶段
1. 播放开场动画介绍杜伦城堡历史
2. 新手引导介绍基本操作
3. 获得初始资源和工匠团队
4. 开始第一个建造任务（地基建设）

### 8.2 发展阶段
1. 完成里程碑解锁新建筑元素
2. 扩大工匠团队规模
3. 升级工具和设施
4. 应对随机事件（天气、材料短缺等）

### 8.3 完成阶段
1. 完成所有历史时期的建筑重建
2. 展示完整城堡3D模型
3. 生成建造报告和成就总结
4. 提供继续游玩选项（装饰、改善等）

## 9. 音效与音乐设计

### 9.1 音效设计
- 工匠工作音效（敲击声、锯木声等）
- 环境音效（风声、鸟鸣等）
- UI交互音效（点击、悬停等）
- 特殊事件音效（解锁、完成等）

### 9.2 背景音乐
- 中世纪风格背景音乐
- 根据建造进度动态调整音乐节奏
- 不同历史时期有不同的音乐主题

## 10. 扩展计划

### 10.1 内容扩展
- 添加更多历史建筑（杜伦大教堂等）
- 引入其他英国历史城堡
- 增加季节和天气系统
- 添加历史事件重现模式

### 10.2 功能扩展
- 多人合作建造模式
- 建造竞赛模式
- VR支持提供沉浸式体验
- 移动端适配版本

### 10.3 社交功能
- 建造成果分享系统
- 成就排行榜
- 社区建造方案交流
- 建造技巧教学视频

## 11. 项目管理

### 11.1 开发阶段
1. **原型阶段** - 核心机制验证
2. **Alpha阶段** - 基础功能完善
3. **Beta阶段** - 内容填充和优化
4. **发布阶段** - 正式上线运营

### 11.2 文件目录结构
```
DurhamCastleBuilder/
├── assets/
│   ├── models/          # 3D模型
│   │   ├── castle/      # 杜伦城堡模型
│   │   ├── workers/     # 工匠模型
│   │   └── tools/       # 工具模型
│   ├── textures/        # 纹理贴图
│   ├── sounds/          # 音效
│   └── fonts/           # 字体
├── js/
│   ├── core/            # 核心逻辑
│   │   ├── Game.js      # 游戏主逻辑
│   │   ├── GameState.js # 游戏状态管理
│   │   ├── Resource.js  # 资源管理
│   │   └── AI.js        # AI行为管理
│   ├── ui/              # UI相关
│   │   ├── UI.js        # UI主类
│   │   ├── HUD.js       # HUD（抬头显示）
│   │   └── Menu.js      # 菜单
│   ├── graphics/        # 图形渲染
│   │   ├── Renderer.js  # 渲染器
│   │   ├── Camera.js    # 相机控制
│   │   └── Lighting.js  # 光照设置
│   ├── utils/           # 工具函数
│   │   ├── MathUtils.js # 数学计算
│   │   └── Pathfinding.js # 路径规划
│   └── main.js          # 主入口
├── workers/             # Web Worker（用于计算密集型任务）
│   └── worker.js        # 工匠AI计算
├── index.html           # 主HTML文件
├── style.css            # 样式表
└── game.json            # 游戏配置
```

Durham Castle Builder不仅是一款建造游戏，更是一个教育平台，让玩家在享受游戏乐趣的同时，深入了解杜伦城堡的历史和文化。通过精心设计的游戏机制、智能的AI行为和清晰的软件架构，我们创造了一个既有趣又有教育意义的游戏体验。